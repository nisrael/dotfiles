---
- name: Install usage with cargo-binstall on Ubuntu
  ansible.builtin.shell:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/cargo binstall -y usage-cli"
  register: usage_install
  changed_when: "'Installing' in usage_install.stderr"
  failed_when: usage_install.rc != 0 and 'already installed' not in usage_install.stderr
  when: ansible_distribution == "Ubuntu"

- name: Install usage with cargo-binstall on Fedora
  ansible.builtin.shell:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/cargo binstall -y usage-cli"
  register: usage_install
  changed_when: "'Installing' in usage_install.stderr"
  failed_when: usage_install.rc != 0 and 'already installed' not in usage_install.stderr
  when: ansible_distribution == "Fedora"

- name: Install usage on macOS
  community.general.homebrew:
    name: usage
    state: present
  when: ansible_distribution == "MacOSX"
