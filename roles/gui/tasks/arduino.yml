---
- name: Ensure ~/.local/bin exists
  file:
    path: "{{ ansible_facts.env.HOME }}/.local/bin"
    state: directory
    mode: '0755'
  when: ansible_facts.system == "Linux"

- name: Download Arduino IDE AppImage
  get_url:
    url: "https://downloads.arduino.cc/arduino-ide/arduino-ide_latest_Linux_64bit.AppImage"
    dest: "{{ ansible_facts.env.HOME }}/.local/bin/arduino-ide.AppImage"
    mode: '0755'
  when: ansible_facts.system == "Linux"

- name: Ensure ~/.local/share/applications exists
  file:
    path: "{{ ansible_facts.env.HOME }}/.local/share/applications"
    state: directory
    mode: '0755'
  when: ansible_facts.system == "Linux"

- name: Create Arduino IDE desktop entry
  copy:
    dest: "{{ ansible_facts.env.HOME }}/.local/share/applications/arduino-ide.desktop"
    mode: '0644'
    content: |
      [Desktop Entry]
      Name=Arduino IDE
      Comment=Open-source electronics platform
      Exec={{ ansible_facts.env.HOME }}/.local/bin/arduino-ide.AppImage %U
      Icon=arduino-ide
      Terminal=false
      Type=Application
      Categories=Development;Electronics;
      MimeType=text/x-arduino;
  when: ansible_facts.system == "Linux"

- name: Install Arduino IDE on macOS
  community.general.homebrew_cask:
    name: arduino-ide
    state: present
  when: ansible_facts.distribution == "MacOSX"
