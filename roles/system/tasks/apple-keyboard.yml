---
- name: Configure Apple keyboard fnmode (F keys as default)
  become: true
  copy:
    content: "options hid_apple fnmode=2\n"
    dest: /etc/modprobe.d/hid_apple.conf
    mode: '0644'
  when: ansible_facts.distribution == "Fedora" and ansible_facts.distribution_major_version|int >= 43
  register: apple_keyboard_conf

- name: Rebuild initramfs for Apple keyboard config
  become: true
  command: dracut --force
  when: apple_keyboard_conf.changed
