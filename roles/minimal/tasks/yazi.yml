---
- name: Create temporary directory for yazi on Ubuntu/Debian
  ansible.builtin.tempfile:
    state: directory
    suffix: yazi
  register: yazi_temp_dir
  when: ansible_os_family == "Debian"

- name: Download and extract yazi binary on Ubuntu/Debian
  ansible.builtin.unarchive:
    src: https://github.com/sxyazi/yazi/releases/download/{{ yazi_version }}/yazi-x86_64-unknown-linux-gnu.zip
    dest: "{{ yazi_temp_dir.path }}"
    remote_src: true
  when: ansible_os_family == "Debian"

- name: Copy yazi binary to /usr/local/bin on Ubuntu/Debian
  become: true
  ansible.builtin.copy:
    src: "{{ yazi_temp_dir.path }}/yazi-x86_64-unknown-linux-gnu/yazi"
    dest: /usr/local/bin/yazi
    mode: '0755'
    remote_src: true
  when: ansible_os_family == "Debian"

- name: Clean up temporary directory on Ubuntu/Debian
  ansible.builtin.file:
    path: "{{ yazi_temp_dir.path }}"
    state: absent
  when: ansible_os_family == "Debian"

- name: Enable COPR repository for yazi on Fedora
  become: true
  community.general.copr:
    name: lihaohong/yazi
    state: enabled
  when: ansible_os_family == "RedHat"

- name: Install yazi on Fedora
  become: true
  dnf:
    name: yazi
    state: present
  when: ansible_os_family == "RedHat"

- name: Install yazi on macOS
  community.general.homebrew:
    name: yazi
    state: present
  when: ansible_distribution == "MacOSX"
