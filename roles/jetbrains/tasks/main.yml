---
# JetBrains IDEs installation tasks
# Installs IntelliJ IDEA Ultimate, PyCharm Professional, RubyMine, CLion, and RustRover
# Supports Linux (x86_64 and ARM) and macOS

- name: Ensure JetBrains installation directories exist
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - "{{ jetbrains_install_dir }}"
    - "{{ jetbrains_bin_dir }}"
  when: ansible_facts.system == "Linux"
  tags:
    - intellij
    - pycharm
    - rubymine
    - clion
    - rustrover

- name: Increase inotify watch limit for JetBrains IDEs
  ansible.builtin.copy:
    dest: /etc/sysctl.d/idea.conf
    content: |
      fs.inotify.max_user_watches = 1048576
    owner: root
    group: root
    mode: '0644'
  when: ansible_facts.system == "Linux"
  become: true
  tags:
    - intellij
    - pycharm
    - rubymine
    - clion
    - rustrover

- name: Apply sysctl settings
  ansible.builtin.command:
    cmd: sysctl -p --system
  when: ansible_facts.system == "Linux"
  become: true
  changed_when: false
  tags:
    - intellij
    - pycharm
    - rubymine
    - clion
    - rustrover

- name: Install IntelliJ IDEA
  import_tasks: intellij.yml
  tags: intellij

- name: Install PyCharm Professional
  import_tasks: pycharm.yml
  tags: pycharm

- name: Install RubyMine
  import_tasks: rubymine.yml
  tags: rubymine

- name: Install CLion
  import_tasks: clion.yml
  tags: clion

- name: Install RustRover
  import_tasks: rustrover.yml
  tags: rustrover
